---

title: Data.Manipulate

keywords: fastai
sidebar: home_sidebar

summary: "IO tools for manipulating medical images"
description: "IO tools for manipulating medical images"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_data.manipulate.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#test</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gdcm</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully imported GDCM&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not import GDCM&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="dcm2array">dcm2array<a class="anchor-link" href="#dcm2array"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dcm2array" class="doc_header"><code>dcm2array</code><a href="https://github.com/UCSF-intelligent-imaging/I2T2/tree/master/I2T2/data/manipulate.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dcm2array</code>(<strong><code>path_to_dicom_dir</code></strong>=<em><code>None</code></em>, <strong><code>sort_by_slice_location</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Transform DICOM data into numpy array.</p>
<p>Attributes:
    path_to_dicom_dir (str): Path to folder containing all dicom files for one patient
    sort_by_slice_location (bool): Whether to return array ordered by slice location</p>
<p>Returns:
    pixel_array (arr): Array of pixel data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3><p><a href="/I2T2/data.manipulate#dcm2array"><code>dcm2array</code></a> takes a path to one DICOM series (patient).</p>
<p>See the example below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;../data/knee/&#39;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">image_array</span> <span class="o">=</span> <span class="n">dcm2array</span><span class="p">(</span><span class="n">path_to_dicom_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sort_by_slice_location</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;could not load array&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Resize">Resize<a class="anchor-link" href="#Resize"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="crop" class="doc_header"><code>crop</code><a href="https://github.com/UCSF-intelligent-imaging/I2T2/tree/master/I2T2/data/manipulate.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>crop</code>(<strong><code>image_array</code></strong>, <strong><code>final_dims_in_pixels</code></strong>, <strong><code>zero_fill_mode</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Crop image data to final_dim_in_pixels</p>
<p>Attributes:
    image_array (float, np.array): 3D numpy array containing image data
    final_dim_in_pixels    (list): Final number of pixels in xyz dimensions. Example: [256, 256, 80]
    zero_fill_mode         (bool): If True, returns array filled with zeros</p>
<p>Returns:
    cropped_image_array (arr): Resized array containing image data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3><p><a href="/I2T2/data.manipulate#crop"><code>crop</code></a> takes an image array and crops the array according to the input dimensions.</p>
<p>See the example below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#test</span>
<span class="n">image_array</span> <span class="o">=</span> <span class="n">dcm2array</span><span class="p">(</span><span class="n">path_to_dicom_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sort_by_slice_location</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cropped_image</span> <span class="o">=</span> <span class="n">crop</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">image_array</span><span class="p">,</span> <span class="n">final_dims_in_pixels</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
<span class="n">cropped_zero_image</span> <span class="o">=</span> <span class="n">crop</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">image_array</span><span class="p">,</span> <span class="n">final_dims_in_pixels</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span> <span class="n">zero_fill_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#original image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="c1">#cropped image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cropped image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="c1">#cropped image zero&#39;d</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cropped zero&#39;d image&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped_zero_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Padding">Padding<a class="anchor-link" href="#Padding"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pad" class="doc_header"><code>pad</code><a href="https://github.com/UCSF-intelligent-imaging/I2T2/tree/master/I2T2/data/manipulate.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pad</code>(<strong><code>image_array</code></strong>, <strong><code>final_dims_in_pixels</code></strong>, <strong><code>zero_fill_mode</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Pad image data to final_dim_in_pixels</p>
<p>Attributes:
    image_array (float, np.array): 3D numpy array containing image data
    final_dim_in_pixels    (list): Final number of pixels in xyz dimensions. Example: [256, 256, 80]
    zero_fill_mode         (bool): If True, returns array filled with zeros</p>
<p>Returns:
    padded_image_array (arr): Resized array containing image data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3><p><a href="/I2T2/data.manipulate#pad"><code>pad</code></a> takes an image array and crops the array according to the input dimensions.</p>
<p>See the example below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">image_array</span> <span class="o">=</span> <span class="n">dcm2array</span><span class="p">(</span><span class="n">path_to_dicom_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sort_by_slice_location</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">padded_image</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">image_array</span><span class="p">,</span> <span class="n">final_dims_in_pixels</span><span class="o">=</span><span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">22</span><span class="p">])</span>
<span class="n">padded_zero_image</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">image_array</span><span class="p">,</span> <span class="n">final_dims_in_pixels</span><span class="o">=</span><span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span> <span class="n">zero_fill_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#original image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="c1">#padded image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Padded image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">padded_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="c1">#padded image zero&#39;d</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Padded zero&#39;d image&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">padded_zero_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Resampling">Resampling<a class="anchor-link" href="#Resampling"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resample" class="doc_header"><code>resample</code><a href="https://github.com/UCSF-intelligent-imaging/I2T2/tree/master/I2T2/data/manipulate.py#L150" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resample</code>(<strong><code>image_array</code></strong>, <strong><code>goal_pixel_dims_list</code></strong>, <strong><code>is_seg</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Resamples <code>image</code> to new resolution according to a compression factor using scipy's <code>ndimage</code></p>
<p>Attributes:
    image_array (float, np.array) : Array of voxel values for image
    goal_pixel_dims_list (list)   : Goals for dimensions of final image (e.g. [256, 256, 128])
    is_seg (bool)                 : Whether or not the image is a segmentation (i.e. pixel values are int)</p>
<p>Returns:
    resampled_image_array (arr): Resampled array containing image data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resample_by" class="doc_header"><code>resample_by</code><a href="https://github.com/UCSF-intelligent-imaging/I2T2/tree/master/I2T2/data/manipulate.py#L177" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resample_by</code>(<strong><code>image_array</code></strong>, <strong><code>compression_factor_list</code></strong>, <strong><code>is_seg</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Resamples <code>image</code> to new resolution according to a compression factor using scipy's <code>ndimage</code></p>
<p>Attributes:
    image_array (float, np.array)  : Array of voxel values for image
    compression_factor_list (list) : Compression or expansino factor (e.g. [0.1, 10.0, 1.0])
    is_seg (bool)                  : Whether or not the image is a segmentation (i.e. pixel values are int)</p>
<p>Returns:
    resampled_image_array (arr): Resampled array containing image data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3><p><a href="/I2T2/data.manipulate#resample"><code>resample</code></a> takes an image array and resamples it to the dimensions given in <code>goal_pixel_dims_list</code>.</p>
<p><a href="/I2T2/data.manipulate#resample_by"><code>resample_by</code></a> is similar to resample but user gives a compression factor instead (e.g. [0.1,0.1,1.0] will resample the image to 10% in x and y directions)</p>
<p>See the examples below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">image_array</span> <span class="o">=</span> <span class="n">dcm2array</span><span class="p">(</span><span class="n">path_to_dicom_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sort_by_slice_location</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">downsampled_image</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">image_array</span><span class="p">,</span> <span class="n">goal_pixel_dims_list</span><span class="o">=</span><span class="p">[</span><span class="mi">51</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">22</span><span class="p">],</span> <span class="n">is_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">upsampled_image</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">downsampled_image</span><span class="p">,</span> <span class="n">goal_pixel_dims_list</span><span class="o">=</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">,</span><span class="mi">22</span><span class="p">],</span> <span class="n">is_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Downsampled image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">downsampled_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Re-upsampled image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">upsampled_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example of using <a href="/I2T2/data.manipulate#resample_by"><code>resample_by</code></a>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">image_array</span> <span class="o">=</span> <span class="n">dcm2array</span><span class="p">(</span><span class="n">path_to_dicom_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sort_by_slice_location</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">downsampled_image</span> <span class="o">=</span> <span class="n">resample_by</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">image_array</span><span class="p">,</span> <span class="n">compression_factor_list</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">is_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">upsampled_image</span> <span class="o">=</span> <span class="n">resample_by</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">downsampled_image</span><span class="p">,</span> <span class="n">compression_factor_list</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">is_seg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Downsampled image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">downsampled_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Re-upsampled image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">upsampled_image</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Resampling-example:">Resampling example:<a class="anchor-link" href="#Resampling-example:"> </a></h4><p>Resampling segmentation to agree with original image</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># read data</span>
<span class="n">image_array</span> <span class="o">=</span> <span class="n">dcm2array</span><span class="p">(</span><span class="n">path_to_dicom_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">sort_by_slice_location</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">knee_segmentation</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;../data/knee-segmentation/knee_segmentation.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">knee_segmentation</span> <span class="o">=</span> <span class="n">knee_segmentation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Knee segmentation dims:&#39;</span><span class="p">,</span> <span class="n">knee_segmentation_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Knee original dims:&#39;</span><span class="p">,</span> <span class="n">image_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># resample to desired shape</span>
<span class="n">resampled_segmentation</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">image_array</span><span class="o">=</span><span class="n">knee_segmentation</span><span class="p">,</span>
                                  <span class="n">goal_pixel_dims_list</span><span class="o">=</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">,</span><span class="mi">22</span><span class="p">),</span>
                                  <span class="n">is_seg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Knee segmentation dims after resampling:&#39;</span><span class="p">,</span> <span class="n">resampled_segmentation</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Segmentation image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">resampled_segmentation</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">])</span>

<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Overlaid segmentation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_array</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span> <span class="c1"># I would add interpolation=&#39;none&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">resampled_segmentation</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span> <span class="c1"># interpolation=&#39;none&#39;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

